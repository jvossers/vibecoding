<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>CPU & RAM Interactive Simulator (Mobile)</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f5f5f5;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
        }
        .sim-description {
            width: 100vw;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.05em;
            color: #333;
            margin: 0;
            padding: 16px 8px 8px 8px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100vw;
            max-width: 100vw;
            margin: 0;
            padding: 0 0 16px 0;
            align-items: stretch;
        }
        .ram, .cpu, .control-panel, .explanation-panel {
            border: 1px solid #ccc;
            padding: 12px 8px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            margin: 0 8px 8px 8px;
        }
        .ram-cells {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(10, min-content);
            grid-auto-flow: column;
            column-gap: 8px;
            row-gap: 3px;
            margin-top: 2px;
        }
        .controls-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .cell {
            width: 100%;
            min-width: 0;
            height: 22px;
            border: 1px solid #888;
            display: flex;
            align-items: center;
            background: #f9f9f9;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.78em;
            padding: 0 2px;
        }
        .cell.active {
            background: #ffe082;
            border-color: #ffa000;
        }
        .cell.referenced {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        .cell-address {
            width: 28px;
            text-align: right;
            color: #888;
            font-size: 0.78em;
            padding-right: 2px;
            font-weight: normal;
        }
        .cell-content {
            flex: 1;
            text-align: left;
            padding-left: 2px;
            font-size: 0.78em;
        }
        .registers { margin-top: 6px; }
        .registers {
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .register {
            background: #f0f4f8;
            border-radius: 6px;
            font-size: 1em;
            padding: 7px 10px 7px 10px;
            margin: 0;
            font-weight: 500;
            color: #222;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            border: 1px solid #e0e0e0;
            letter-spacing: 0.01em;
        }
        .current-instruction-label {
            font-size: 1em;
            margin-top: 8px;
            background: #f8fafc;
            border-radius: 6px;
            padding: 7px 10px;
            color: #333;
            font-weight: 500;
            border: 1px solid #e0e0e0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .controls-tray {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100vw;
            height: 54px;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            display: flex;
            z-index: 100;
        }
        .controls-tray button {
            flex: 1 1 0;
            height: 100%;
            border: none;
            border-radius: 0;
            font-size: 1.05em;
            font-weight: bold;
            color: #fff;
            background: #1976d2;
            box-shadow: none;
            margin: 0;
            cursor: pointer;
            transition: background 0.2s, filter 0.2s;
        }
        .controls-tray button:last-child {
            background: #d32f2f;
        }
        .controls-tray button:active {
            filter: brightness(0.95);
        }
        .controls {
            display: none;
        }
        body {
            padding-bottom: 54px;
        }
        .instruction { font-family: monospace; }
        .explanation-panel {
            min-height: 40px;
            margin: 2px 8px 0 8px;
        }
        .explanation-content {
            color: #444;
            font-size: 0.9em;
            line-height: 1.2;
        }
        h1 {
            display: none;
        }
        h2 {
            display: none;
        }
        @media (max-width: 400px) {
            .cell-address { width: 30px; font-size: 0.9em; }
            .cell-content { font-size: 0.9em; }
            .register { font-size: 0.95em; }
        }
    </style>
</head>
<body>
    <!-- Top explanation removed for condensed view -->
    <div class="container">
        <div class="cpu">
            <div style="font-size:1em;font-weight:bold;margin-bottom:2px;">CPU</div>
            <div class="registers">
                <div class="register">Accumulator (ACC): <span id="acc">0</span></div>
                <div class="register">Program Counter (PC): <span id="pc">0</span></div>
            </div>
            <div class="current-instruction-label">Current Instruction: <span id="currentInstruction" class="instruction"></span></div>
        <!-- Remove any CSS text that was accidentally placed here -->
        </div>
        <!-- Controls moved to tray at bottom -->
        <div class="ram">
            <div style="font-size:1em;font-weight:bold;margin-bottom:2px;">RAM</div>
            <div id="ramCells" class="ram-cells"></div>
        </div>
        <div class="explanation-panel">
            <div id="instructionExplanation" class="explanation-content"></div>
        </div>
    </div>

    <script>
    // ...existing code from cpu.html script block...
    (function() {
        window.ram = [
            'LOAD 0x10',
            'ADD 0x11',
            'STORE 0x14',
            'MUL 0x11',
            'STORE 0x15',
            'DIV 0x13',
            'STORE 0x16',
            'SUB 0x11',
            'STORE 0x17',
            'LOAD 0x14',
            'MUL 0x11',
            'STORE 0x18',
            'JUMP 0x00',
            'HLT',
            'HLT',
            0, 0, 0, 0, 0, 0,
            5,
            3,
            10,
            4,
            0,
            0,
            0,
            0,
            0
        ];
        window.pc = 0;
        window.acc = 0;
        window.halted = false;
        window.instructionExplanations = {
            'LOAD': (arg) => `LOAD ${arg}: Load the value from RAM address ${arg} into the accumulator (ACC). This copies the value, leaving the original in RAM.`,
            'ADD': (arg) => `ADD ${arg}: Add the value from RAM address ${arg} to the accumulator (ACC). This performs ACC = ACC + RAM[${arg}]`,
            'SUB': (arg) => `SUB ${arg}: Subtract the value from RAM address ${arg} from the accumulator (ACC). This performs ACC = ACC - RAM[${arg}]`,
            'MUL': (arg) => `MUL ${arg}: Multiply the accumulator (ACC) by the value in RAM address ${arg}. This performs ACC = ACC * RAM[${arg}]`,
            'DIV': (arg) => `DIV ${arg}: Divide the accumulator (ACC) by the value in RAM address ${arg}. This performs ACC = ACC / RAM[${arg}]`,
            'STORE': (arg) => `STORE ${arg}: Store the value from the accumulator (ACC) into RAM address ${arg}. This writes ACC into RAM[${arg}]`,
            'JUMP': (arg) => `JUMP ${arg}: Jump to the instruction at RAM address ${arg}. This sets the Program Counter (PC) to point to the new address.`,
            'HLT': () => 'HLT: Halt the CPU. The program has finished executing all instructions.'
        };
        window.showExplanation = function(text) {
            const expl = document.getElementById('instructionExplanation');
            if (expl) {
                expl.innerText = text;
            }
        };
        window.render = function() {
            const container = document.getElementById('ramCells');
            container.innerHTML = '';
            let referencedAddr = null;
            if (window.pc !== null) {
                const instruction = window.ram[window.pc];
                if (typeof instruction === 'string') {
                    const [op, arg] = instruction.split(' ');
                    if (arg) {
                        referencedAddr = parseInt(arg, 16);
                    }
                }
            }
            for (let i = 0; i < window.ram.length; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                if (i === window.pc) {
                    cell.classList.add('active');
                }
                if (i === referencedAddr) {
                    cell.classList.add('referenced');
                }
                const addr = document.createElement('div');
                addr.classList.add('cell-address');
                addr.innerText = '0x' + i.toString(16).toUpperCase();
                const content = document.createElement('div');
                content.classList.add('cell-content');
                content.innerText = window.ram[i];
                cell.appendChild(addr);
                cell.appendChild(content);
                container.appendChild(cell);
                cell.addEventListener('click', () => {
                    window.currentInstruction = i;
                    render();
                });
            }
            document.getElementById('acc').innerText = window.acc;
            document.getElementById('pc').innerText = '0x' + window.pc.toString(16).toUpperCase();
            document.getElementById('currentInstruction').innerText = window.ram[window.pc];
            if (typeof window.ram[window.pc] === 'string') {
                const [op, arg] = window.ram[window.pc].split(' ');
                if (window.instructionExplanations[op]) {
                    window.showExplanation(window.instructionExplanations[op](arg));
                }
            }
        };
        window.step = function() {
            if (window.halted) return;
            const instr = window.ram[window.pc];
            if (typeof instr === 'string') {
                const [op, arg] = instr.split(' ');
                switch (op) {
                    case 'LOAD':
                        window.acc = window.ram[parseInt(arg, 16)];
                        window.pc++;
                        break;
                    case 'ADD':
                        window.acc += window.ram[parseInt(arg, 16)];
                        window.pc++;
                        break;
                    case 'SUB':
                        window.acc -= window.ram[parseInt(arg, 16)];
                        window.pc++;
                        break;
                    case 'MUL':
                        window.acc *= window.ram[parseInt(arg, 16)];
                        window.pc++;
                        break;
                    case 'DIV':
                        window.acc /= window.ram[parseInt(arg, 16)];
                        window.pc++;
                        break;
                    case 'STORE':
                        window.ram[parseInt(arg, 16)] = window.acc;
                        window.pc++;
                        break;
                    case 'JUMP':
                        window.pc = parseInt(arg, 16);
                        break;
                    case 'HLT':
                        window.halted = true;
                        window.pc++;
                        break;
                }
            }
            window.render();
        };
        window.resetSim = function() {
            window.ram[0x10] = 5;
            window.ram[0x11] = 3;
            window.ram[0x12] = 10;
            window.ram[0x13] = 4;
            window.ram[0x14] = 0;
            window.ram[0x15] = 0;
            window.ram[0x16] = 0;
            window.pc = 0;
            window.acc = 0;
            window.halted = false;
            window.showExplanation('Program reset. Ready to start!');
            window.render();
        };
        document.addEventListener('DOMContentLoaded', function() {
            window.resetSim();
        });
    })();
    </script>
</body>
</body>
<div class="controls-tray">
    <button onclick="window.step()">
        <span style="display:inline-flex;align-items:center;gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            Execute
        </span>
    </button>
    <button onclick="window.resetSim()">
        <span style="display:inline-flex;align-items:center;gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
            Reset
        </span>
    </button>
</div>
</html>
